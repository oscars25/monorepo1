version: '3.8'

services:
  # ... (Servicio DB sin cambios) ...
  db:
    # ... (Configuración de DB) ...

  # ------------------------------------
  # 2. SERVICIO BACKEND (Sin cambios)
  # ------------------------------------
  backend:
    build:
      context: ./chat-widget-monorepo/chat-widget-backend
      dockerfile: Dockerfile.backend
    ports:
      - "8080:8080" # El puerto de Spring Boot
    depends_on:
      - db 
    volumes:
      - ./chat-widget-monorepo/chat-widget-backend:/app # Mapeo para desarrollo

  # ------------------------------------
  # 3. SERVICIO FRONTEND (Cambios en build y ports)
  # ------------------------------------
  frontend:
    build:
      context: ./chat-widget-monorepo/frontend-dashboard
      dockerfile: Dockerfile.frontend
    ports:
      - "80:80" # Mapea el puerto 80 del contenedor al puerto 80 de tu máquina
    depends_on:
      - backend # El frontend debe iniciar después del backend para comunicación
    volumes:
      - ./chat-widget-monorepo/frontend-dashboard/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      # NOTA: En un flujo de producción, no es común montar el código fuente completo del frontend con Angular/Nginx.
      # Para el desarrollo, usaremos el puerto 80.
volumes:
  db-data: